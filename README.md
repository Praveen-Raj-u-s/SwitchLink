# SwitchLink

SwitchLink is a Smart Switch Control Unit that goes beyond conventional remote switch control. It features a Smart USB charging system utilizing an OP Amp comparator to detect the full-charge status of connected devices. This feature is especially useful for devices and appliances lacking built-in Charge Protection Circuitry. When a device reaches full charge, SwitchLink notifies the user with defined acoustic notifications generated by a Piezo-buzzer via PWM.

## Key components and functionalities include:

* Smart USB Charging System: Monitors and indicates full-charge status using an OP Amp comparator.
* Acoustic Notifications: Utilizes a Piezo-buzzer controlled through PWM to notify users when charging is complete.
* Relay Module: Enables control of electrical switches.
* Proximity Sensors: Provides a non-contact user interface for switch control.
* Remote Control: Allows switching control over the Internet using MQTT.
* SwitchLink enhances the usability and safety of home appliances and devices, providing both manual and remote control options.

Bill of Materials: https://github.com/Praveen-Raj-u-s/SwitchLink/blob/main/Bill%20of%20Materials.BomDoc


## Critical Components:

Microcontroller (MCU):
SAMW25 Xplained Pro: This microcontroller handles all processing tasks, including sensor data acquisition, control logic, and communication. It is integrated with FreeRTOS for real-time task management and efficient operation.

![image-removebg-preview](https://github.com/Praveen-Raj-u-s/SwitchLink/assets/114270637/be7518bf-673f-40b1-af91-a3addea1cad7)

Sensors:

* VL6180X Proximity Sensors: Two proximity sensors are used for non-contact switch control. These sensors detect the presence of a hand or object near the switch, allowing for gesture-based control of the connected devices.

![image-removebg-preview (1)](https://github.com/Praveen-Raj-u-s/SwitchLink/assets/114270637/3cc1c76a-1670-48ac-99c9-2f5dde4c7727)


* OP Amp Comparator: Used in the Smart USB charging system to detect the full-charge status of connected devices. This comparator monitors the voltage level and triggers notifications when the device is fully charged.

![image-removebg-preview (2)](https://github.com/Praveen-Raj-u-s/SwitchLink/assets/114270637/92fff826-ceda-4f69-b764-4a4bd96e856c)


Actuators:

* Relay Module: Controls the switching of electrical devices. The relay module is activated based on inputs from the proximity sensors or remote commands received over the Internet.

* Piezo-buzzer: Generates acoustic notifications when a device connected to the USB charging system is fully charged. The buzzer is controlled using PWM signals to create different sound patterns.

Communication Module:

 * MQTT Protocol: Enables remote control and monitoring of the switches over the Internet. The device connects to an MQTT broker, allowing users to send commands and receive status updates from anywhere with Internet access.


Power Management:

* LDO: MCP1700T converts the input of 3.3V to 4.2V to 2.8V and supplies to the VL6180X sensor whose ideal working voltage is 2.8V.

![image-removebg-preview (3)](https://github.com/Praveen-Raj-u-s/SwitchLink/assets/114270637/042b3e7d-523f-44be-9395-02d7f2b7e3a4)


* Buck Converter: TPS62082DSGR supplies to most of the compoents a stable 3.3V from the 3.3V to 4.2V input.

![image-removebg-preview (4)](https://github.com/Praveen-Raj-u-s/SwitchLink/assets/114270637/093e6745-98b5-4a6d-9cec-6dc62b5534f6)

  
## Block Diagram:

![image](https://github.com/Praveen-Raj-u-s/SwitchLink/assets/114270637/c8816c0a-f5d6-4f1b-b5fa-2764fc3267ef)


## Functional Workflow:

* Power Up: The device initializes, and the PMIC ensures stable power distribution to all components.
* Sensor Monitoring: The proximity sensors continuously monitor for user gestures to control the switches.
* Charge Detection: The OP Amp comparator monitors the voltage level of connected devices.
* User Interaction: When a proximity sensor detects a hand gesture, it sends a signal to the MCU, which activates the corresponding relay to turn the device on or off.
* Remote Commands: Users can send commands via the Internet using the MQTT protocol, allowing remote control of the switches.
* Notifications: When a device reaches full charge, the OP Amp comparator triggers the Piezo-buzzer to notify the user acoustically.


## PCB Designing:

Altium Designer was leveraged for Footprint Creation, Schematic Capture, layout, Workmanship, Gerber File generation etc.

Altium Project Link: https://upenn-eselabs.365.altium.com/designs/0D535367-1C3A-4320-998F-776AB24CDA05


## Schematics:

Main Sheet:

![Switchlink Schematics-01](https://github.com/Praveen-Raj-u-s/SwitchLink/assets/114270637/bcf5ba8b-e43f-4cb7-9aed-f86b0244c826)

Memory:
  
![Switchlink Schematics-02](https://github.com/Praveen-Raj-u-s/SwitchLink/assets/114270637/7399f2b9-9b40-4a14-bfcb-3d1940047235)

MCU:

![Switchlink Schematics-03](https://github.com/Praveen-Raj-u-s/SwitchLink/assets/114270637/1a79a15c-ed98-44dc-aca4-44ec9ed4b5fc)

USB to Serial FTDI:

![Switchlink Schematics-04](https://github.com/Praveen-Raj-u-s/SwitchLink/assets/114270637/d8d221ff-b83c-4f61-98e9-1a9999b1437a)

LIPO Charger:

![Switchlink Schematics-05](https://github.com/Praveen-Raj-u-s/SwitchLink/assets/114270637/9940557d-a484-41e3-8d47-081e26c06199)

Buck Converter:

![Switchlink Schematics-06](https://github.com/Praveen-Raj-u-s/SwitchLink/assets/114270637/8d996f85-a7ac-4376-bde6-4b34112619f7)

Piezo-Buzzer:

![Switchlink Schematics-07](https://github.com/Praveen-Raj-u-s/SwitchLink/assets/114270637/be58b38a-cdf2-429b-8225-414e3e691ce0)

LDO:

![Switchlink Schematics-08](https://github.com/Praveen-Raj-u-s/SwitchLink/assets/114270637/4c64e0d1-cc46-41be-9a11-3afdbac27f4b)

Proximity Sensor:
  
![Switchlink Schematics-09](https://github.com/Praveen-Raj-u-s/SwitchLink/assets/114270637/6ed32399-0cc6-4e11-8f7d-774d0ad69ed0)


USB-C Receptor:
  
![Switchlink Schematics-11](https://github.com/Praveen-Raj-u-s/SwitchLink/assets/114270637/4134a43d-57e8-428c-b7f9-c8e66e54cece)



## PCB Simulation:

2D:

![image](https://github.com/Praveen-Raj-u-s/SwitchLink/assets/114270637/4bdf7e33-6d25-4709-910c-d449d8802ac1)

3D: 

![image](https://github.com/Praveen-Raj-u-s/SwitchLink/assets/114270637/3eafb325-c32c-4426-a93c-409aa4327eb4)

## Fabrication & Assembly Files (Draftsmanship):

File Link: https://github.com/Praveen-Raj-u-s/SwitchLink/tree/main/Draftsmanship


## PCB Fabricated:

Top:

![image](https://github.com/Praveen-Raj-u-s/SwitchLink/assets/114270637/ebb32657-d3be-49cf-a482-96b2a961031c)

![image](https://github.com/Praveen-Raj-u-s/SwitchLink/assets/114270637/644ea6bf-3a63-46c2-9a9c-20f69c43f8b4)


Bottom:

![WhatsApp Image 2024-05-14 at 21 51 46_9ab4633a](https://github.com/Praveen-Raj-u-s/SwitchLink/assets/114270637/192e6fb9-3aff-42c0-ac5f-dc6092616151)


## PCB Testing:

### Power System Evaluation:

#### Distinct Power Modes:

The device has two power sources: single cell LiPo and USB power. It has one regulator: a 3.3V buck and an LDO to provide a 2.8V for the proximity sensors. My distinct power modes would be:

Unregulated battery only is connected and ranges from 3.30V to 4.20V
Regulated USB only is connected and ranges from 4.85V to 5.25V
Both battery and USB are connected, so the USB voltage will be preferred (4.85-5.25V)

#### Power Regulation Evaluation: 

We want to determine how well (if at all!) the PCBA power regulation circuitry is working. We’ll leverage the oscilloscopes in the lab to capture various critical modes. Key questions we’ll be answering in this section are:

Are there any critical failures (i.e shorting, over voltage, etc.)?

Are we generating the voltage we expected?

Is the ripple on the output acceptable?

Setup for Evaluation:

![image](https://github.com/Praveen-Raj-u-s/SwitchLink/assets/114270637/a5fdf0a5-9cd1-4697-9663-443c5a3e3e24)


Oscilloscope capture of the startup transient of the regulated output:

![image](https://github.com/Praveen-Raj-u-s/SwitchLink/assets/114270637/845e294a-c50f-4e6f-b1b5-9725a99df6e5)


Oscilloscope capture of the steady state of the regulated output:

![image](https://github.com/Praveen-Raj-u-s/SwitchLink/assets/114270637/cfc490a0-c863-4d05-8764-80b57899dc04)


#### E-load testing:

We’ll load test our riskiest regulation circuit. We do not need to do load testing on all of our power regulation circuits! Only the one that is the highest risk. For example, if I have a 3.3V buck or a 12V boost, I would be more concerned about the large change in voltage required for the 12V boost.

For a chosen regulation circuit, we review our expected current load. Then, use the E-Load to evaluate the following conditions: 10%, 50%, 100%, and 120% of the expected current load. The E-Load will be measuring the actual voltage with the applied load - this is what we want to log.

logged Values: [E-Load Test Values.xlsx](https://github.com/Praveen-Raj-u-s/SwitchLink/files/15317090/E-Load.Test.Values.xlsx)


#### Thermal Evaluation under load:

With our device under load, we take an image using the thermal camera.

10% Load:

![image](https://github.com/Praveen-Raj-u-s/SwitchLink/assets/114270637/edc408e7-f16a-4fee-ac85-7dc5f9394a36)

50% Load:

![image](https://github.com/Praveen-Raj-u-s/SwitchLink/assets/114270637/99f1bcb9-960e-41dd-891c-10269b59ac5e)

#### Programming the board:

JLink Debugger Connection:

![image](https://github.com/Praveen-Raj-u-s/SwitchLink/assets/114270637/f6128ad1-4b5b-434f-95c5-ef873fe64c37)

Device Programming in Atemel Microchip Studio:

![image](https://github.com/Praveen-Raj-u-s/SwitchLink/assets/114270637/f83fa6c3-2adc-4e2e-9536-98aeee8abee9)


#### Peripheral Testing:

Now that we can program our PCBA, it is time to start bringing up the peripherals in your system. Typically, we bring the systems online one by one. For each of these following steps, we may run into failures. In such failures, we review our firmware and Altium hardware files to try to find issues. We Use the debugging tools in the lab to check for voltage, analyze serial communication, etc.

## Programming:

We use FreeRTOS for the whole implementation owing to its concurrency capabilities.

Atmel Microchip Studio Project: https://github.com/Praveen-Raj-u-s/SwitchLink/tree/main/Code%20-%20Atmel%20Microchip%20Studio%20Project

## 3D Design:

I did the CAD design in Autodesk Fusion 360 

![image](https://github.com/Praveen-Raj-u-s/SwitchLink/assets/114270637/ff0209a3-6946-4e3f-bc7c-460af0e518f7)





